generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  OWNER
  ADMIN
}

enum WaterType {
  RIVER
  LAKE
  POND
  SEA
  OTHER
}

enum LocationStatus {
  PENDING
  APPROVED
  REJECTED
  HIDDEN
}

enum RegionCode {
  VINNYTSIA
  VOLYN
  DNIPROPETROVSK
  DONETSK
  ZHYTOMYR
  ZAKARPATTIA
  ZAPORIZHZHIA
  IVANO_FRANKIVSK
  KYIV
  KIROVOHRAD
  LUHANSK
  LVIV
  MYKOLAIV
  ODESA
  POLTAVA
  RIVNE
  SUMY
  TERNOPIL
  KHARKIV
  KHERSON
  KHMELNYTSKYI
  CHERKASY
  CHERNIVTSI
  CHERNIHIV
  CRIMEA
}


enum InquiryStatus {
  NEW
  READ
  CLOSED
}

enum ReportReason {
  SPAM
  WRONG_INFO
  DANGEROUS
  PRIVATE_PROPERTY
  OTHER
}

enum ReportStatus {
  NEW
  IN_REVIEW
  RESOLVED
  DISMISSED
}

model User {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email        String   @unique
  passwordHash String
  role         Role     @default(USER)
  displayName  String?  @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  locations    Location[]
  reviews      Review[]
  favorites    Favorite[]
  inquiriesOut Inquiry[] @relation("InquiryFromUser")
  inquiriesIn  Inquiry[] @relation("InquiryToOwner")
  reports      Report[]
}

model Location {
  id          String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  ownerId     String         @db.Uuid
  owner       User           @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  title       String
  description String
  contactInfo String?        @map("contactinfo")
  region      RegionCode
  waterType   WaterType
  lat         Decimal
  lng         Decimal
  status      LocationStatus @default(PENDING)

  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @default(now()) @updatedAt

  photos      Photo[]
  reviews     Review[]
  favorites   Favorite[]
  inquiries   Inquiry[]
  reports     Report[]

  fish        LocationFish[]
  seasons     LocationSeason[]

  @@index([status])
  @@index([region])
  @@index([waterType])
}

model Fish {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String   @unique
  createdAt DateTime @default(now())

  locations LocationFish[]
}

model Season {
  id   String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code String @unique
  name String

  locations LocationSeason[]
}

model LocationFish {
  locationId String @db.Uuid
  fishId     String @db.Uuid

  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  fish       Fish     @relation(fields: [fishId], references: [id], onDelete: Cascade)

  @@id([locationId, fishId])
}

model LocationSeason {
  locationId String @db.Uuid
  seasonId   String @db.Uuid

  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  season     Season   @relation(fields: [seasonId], references: [id], onDelete: Cascade)

  @@id([locationId, seasonId])
}

model Photo {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  locationId String   @db.Uuid
  url        String
  caption    String?
  createdAt  DateTime @default(now())

  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@index([locationId])
}

model Review {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  locationId String   @db.Uuid
  userId     String   @db.Uuid

  rating     Int
  comment    String

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([locationId, userId])
  @@index([locationId])
}

model Favorite {
  userId     String   @db.Uuid
  locationId String   @db.Uuid
  createdAt  DateTime @default(now())

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@id([userId, locationId])
  @@index([locationId])
  @@index([userId])
}

model Inquiry {
  id         String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  locationId String        @db.Uuid
  fromUserId String        @db.Uuid
  ownerId    String        @db.Uuid

  subject    String
  message    String
  status     InquiryStatus @default(NEW)

  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  location   Location      @relation(fields: [locationId], references: [id], onDelete: Cascade)
  fromUser   User          @relation("InquiryFromUser", fields: [fromUserId], references: [id], onDelete: Cascade)
  owner      User          @relation("InquiryToOwner", fields: [ownerId], references: [id], onDelete: Cascade)

  @@index([ownerId, status])
  @@index([fromUserId])
}

model Report {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  locationId     String       @db.Uuid
  reporterUserId String?      @db.Uuid

  reason         ReportReason
  details        String?
  status         ReportStatus @default(NEW)

  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  location       Location     @relation(fields: [locationId], references: [id], onDelete: Cascade)
  reporterUser   User?        @relation(fields: [reporterUserId], references: [id], onDelete: SetNull)

  @@index([status])
  @@index([locationId])
}